<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel LATAM - Cortes</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: rgba(75, 0, 110, 0.95);
      padding: 1.5vh 2vw;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
    }

    .header h1 {
      font-size: 4vh;
      font-weight: 700;
      margin-bottom: 0.5vh;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      letter-spacing: 1px;
    }

    .header-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 2.2vh;
      font-weight: 500;
    }
<div id="mensagem-erro" class="error-message" style="display: none;"></div>

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 1vw;
    }

    .status-dot {
      width: 1.5vh;
      height: 1.5vh;
      border-radius: 50%;
      background: #00ff00;
      animation: pulse 2s infinite;
    }

    .status-dot.error {
      background: #ff4444;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .main-content {
      flex: 1;
      padding: 2vh 2vw;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .table-container {
      flex: 1;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      height: 100%;
    }

    thead {
      background: rgba(75, 0, 110, 0.8);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    th {
      padding: 2vh 1vw;
      font-size: 2.5vh;
      font-weight: 700;
      text-align: center;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      letter-spacing: 0.5px;
    }

    tbody {
      height: 100%;
      overflow-y: auto;
    }

    td {
      padding: 1.8vh 1vw;
      font-size: 2.2vh;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-weight: 500;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.05);
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.01);
      transition: all 0.3s ease;
    }

    .peso-cell {
      font-weight: 700;
      color: #ffeb3b;
    }

    .motivo-cell {
      font-size: 2vh;
      max-width: 25vw;
      word-wrap: break-word;
    }

    .alert-flash {
      animation: alertFlash 0.5s ease-in-out;
    }

    @keyframes alertFlash {
      0% { background: rgba(255, 0, 0, 0.8); }
      50% { background: rgba(255, 255, 0, 0.8); }
      100% { background: transparent; }
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50vh;
      font-size: 3vh;
    }

    .spinner {
      width: 5vh;
      height: 5vh;
      border: 0.5vh solid rgba(255, 255, 255, 0.3);
      border-top: 0.5vh solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 2vw;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      background: rgba(255, 68, 68, 0.9);
      color: white;
      padding: 2vh;
      border-radius: 10px;
      margin: 2vh;
      text-align: center;
      font-size: 2.5vh;
      font-weight: 600;
    }

    .no-data {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50vh;
      font-size: 3vh;
      color: rgba(255, 255, 255, 0.7);
    }

    /* Responsividade para diferentes tamanhos de TV */
    @media (max-width: 1366px) {
      .header h1 { font-size: 3.5vh; }
      .header-info { font-size: 2vh; }
      th { font-size: 2.2vh; }
      td { font-size: 2vh; }
    }

    @media (min-width: 2560px) {
      .header h1 { font-size: 5vh; }
      .header-info { font-size: 2.5vh; }
      th { font-size: 3vh; }
      td { font-size: 2.5vh; }
    }

    /* Modo noturno automÃ¡tico */
    @media (prefers-color-scheme: dark) {
      body {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸ›« Painel de Voos Cortados - LATAM</h1>
    <div class="header-info">
      <div id="hora-atual">--/--/---- --:--:--</div>
      <div class="status-indicator">
        <div class="status-dot" id="status-dot"></div>
        <span id="status-text">Conectado</span>
      </div>
      <div id="peso-total">Peso total cortado: 0 kg</div>
    </div>
  </div>

  <div class="main-content">
    <div class="table-container">
      <table id="tabela">
     <thead>
  <tr>
    <th style="width: 15%;">Voo</th>
    <th style="width: 15%;">Tipo</th>
    <th style="width: 15%;">Rota</th>
    <th style="width: 10%;">Peso</th>
    <th style="width: 25%;">Motivo</th>
    <th style="width: 10%;">Data</th>
    <th style="width: 10%;">Hora</th>
  </tr>
</thead>
        <tbody id="tabela-body">
          <tr>
            <td colspan="4" class="loading">
              <div class="spinner"></div>
              Carregando dados...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

 
<script>
  class PainelVoos {
    constructor() {
      this.url = 'https://script.google.com/macros/s/AKfycbzp1fJ4tZmwMjqC2tdrkq3OPvvy_gQhxMr99EtqncNgZ7JHRMNoP4CaRQd3ZHShsL_L/exec';
      this.ultimaQuantidade = 0;
      this.tentativasErro = 0;
      this.maxTentativas = 3;
      this.intervaloAtualizacao = 5000;
      this.timeoutRequisicao = 10000;

      this.elementos = {
        horaAtual: document.getElementById('hora-atual'),
        pesoTotal: document.getElementById('peso-total'),
        tabelaBody: document.getElementById('tabela-body'),
        statusDot: document.getElementById('status-dot'),
        statusText: document.getElementById('status-text')
      };

      this.inicializar();
    }

    inicializar() {
      this.atualizarHora();
      this.atualizarTabela();
      setInterval(() => this.atualizarHora(), 1000);
      setInterval(() => this.atualizarTabela(), this.intervaloAtualizacao);
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) this.atualizarTabela();
      });
    }

    atualizarHora() {
      const agora = new Date();
      const data = agora.toLocaleDateString('pt-BR');
      const hora = agora.toLocaleTimeString('pt-BR');
      this.elementos.horaAtual.textContent = `${data} - ${hora}`;
    }

    async atualizarTabela() {
      try {
        this.definirStatus('loading', 'Atualizando...');
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), this.timeoutRequisicao);

        const response = await fetch(this.url, {
          signal: controller.signal,
          cache: 'no-cache'
        });

        clearTimeout(timeoutId);
        if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        const dados = await response.json();
        if (dados.error) throw new Error(dados.message || 'Erro no servidor');

        this.processarDados(dados);
        this.tentativasErro = 0;
        this.definirStatus('success', 'Conectado');

      } catch (error) {
        console.error('Erro ao buscar dados:', error);
        this.tentativasErro++;
        if (this.tentativasErro >= this.maxTentativas) {
          this.mostrarErro(`Erro de conexÃ£o: ${error.message}`);
          this.definirStatus('error', 'Erro de conexÃ£o');
        } else {
          this.definirStatus('error', `Tentativa ${this.tentativasErro}/${this.maxTentativas}`);
        }
      }
    }

    processarDados(dados) {
      if (dados.length && typeof dados[0].voo === "string" &&
          dados[0].voo.toLowerCase().includes("flight")) {
        dados.shift();
      }

      const filtrados = dados.filter(item => {
        const pesoBruto = String(item.peso || '').replace(/[^\d.,]/g, '').replace(',', '.').trim();
        const peso = parseFloat(pesoBruto);
        const motivo = item.motivo && String(item.motivo).trim();
        return motivo && motivo !== '' && !isNaN(peso) && peso > 0 && peso < 50000;
      });

      const pesoTotal = filtrados.reduce((acc, item) => {
        const peso = parseFloat(String(item.peso).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        return acc + peso;
      }, 0);

      this.elementos.pesoTotal.textContent = `Peso total cortado: ${pesoTotal.toLocaleString('pt-BR')} kg`;

      this.atualizarTabelaHTML(filtrados);

      if (filtrados.length > this.ultimaQuantidade) {
        this.ultimaQuantidade = filtrados.length;
        this.mostrarAlerta();
      } else {
        this.ultimaQuantidade = filtrados.length;
      }
    }

    atualizarTabelaHTML(dados) {
      if (dados.length === 0) {
        this.elementos.tabelaBody.innerHTML = `
          <tr>
            <td colspan="7" class="no-data">
              âœ… Nenhum voo cortado no momento
            </td>
          </tr>
        `;
        return;
      }

      const html = dados.map(item => {
        const peso = parseFloat(String(item.peso).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        const pesoFormatado = peso.toLocaleString('pt-BR');

        return `
          <tr>
            <td><strong>${this.sanitizarTexto(item.voo || '')}</strong></td>
            <td>${this.sanitizarTexto(item.tipo || '')}</td>
            <td>${this.sanitizarTexto(item.rota || '')}</td>
            <td class="peso-cell">${pesoFormatado}</td>
            <td class="motivo-cell">${this.sanitizarTexto(item.motivo || '')}</td>
            <td>${this.sanitizarTexto(item.data || '')}</td>
            <td>${this.sanitizarTexto(item.hora || '')}</td>
          </tr>
        `;
      }).join('');

      this.elementos.tabelaBody.innerHTML = html;
    }

    sanitizarTexto(texto) {
      if (!texto) return '';
      return String(texto).replace(/[<>]/g, '').trim();
    }

    mostrarAlerta() {
      document.body.classList.add('alert-flash');
      setTimeout(() => document.body.classList.remove('alert-flash'), 500);
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.2);
      } catch (e) {
        console.log('Ãudio nÃ£o disponÃ­vel');
      }
    }

    mostrarErro(mensagem) {
      const erroEl = document.getElementById('mensagem-erro');
      erroEl.textContent = `âš ï¸ ${mensagem}`;
      erroEl.style.display = 'block';
    }

    definirStatus(tipo, texto) {
      this.elementos.statusText.textContent = texto;
      this.elementos.statusDot.className = `status-dot ${tipo === 'error' ? 'error' : ''}`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new PainelVoos();
  });

  function ativarFullscreen() {
    const el = document.documentElement;
    if (el.requestFullscreen) el.requestFullscreen();
    else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    else if (el.msRequestFullscreen) el.msRequestFullscreen();
  }

  document.addEventListener('keydown', (e) => {
    if (e.key === 'F11' || (e.key === 'f' && e.ctrlKey)) {
      e.preventDefault();
      ativarFullscreen();
    }
  });
</script>
</body>
</html>

